---
title: "Dirichlet elicitation"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Example using the methodology and case study in Zapata-Vazquez, R., O'Hagan, A. and Bastos, L. S. (2014). Eliciting expert judgements about a set of proportions. Journal of Applied Statistics 41, 1919-1933. Quoting from their Section 3.4,

> This example concerns the efficacy of a new antibiotic in patients who are hospitalised in the Pediatric Intensive Care Unit (PICU) and who are severely infected by pneumococci (which is associated with pneumonia, meningitis, and septicaemia, among other conditions). The possible results after the infection are: to survive in good condition, to have a sequel, or to die. An expert is asked to provide judgements about the proportions of patients who will have each of these possible results. Denoting these proportions by $\pi_1$, $\pi_2$, $\pi_3$, these form a set of proportions that must sum to 1.

The Dirichlet distribution is parameterised by
$$
f(\pi_1,\pi_2,\pi_3)\propto \prod_{i=1}^3\pi_i^{d_i-1},
$$
with $n=\sum_{i=1}^3 d_i$.

The elicited judgements for the three marginal proportions were

|                | Good outcome | Sequel | Dead |
|----------------|--------------|--------|------|
| Lower quartile | 0.50         | 0.22   | 0.11 |
|         Median | 0.55         | 0.30   | 0.15 |
| Upper quartile | 0.60         | 0.35   | 0.20 |



Fitting the marginal distributions

```{r }
library(SHELF)
p1 <- c(0.25, 0.5, 0.75)
v1 <- c(0.5, 0.55, 0.6)
v2 <- c(0.22, 0.3, 0.35)
v3 <- c(0.11, 0.15, 0.2)
myfit1 <- fitdist(vals = v1, probs = p1, lower = 0, upper = 1)
myfit2 <- fitdist(vals = v2, probs = p1, lower = 0, upper = 1)
myfit3 <- fitdist(vals = v3, probs = p1, lower = 0, upper = 1)
```

Fitting the Dirichlet to the elicited marginals


```{r }
d.fit <- fitDirichlet(myfit1, myfit2, myfit3,
                  categories = c("Good outcome","Sequel","Dead"),
                  n.fitted = "opt")
```

Parameters of the fitted Dirichlet
```{r}
d.fit
```

Reporting feedback from the marginal distributions of the fitted Dirichlet

```{r}
feedbackDirichlet(d.fit, quantiles = c(0.1, 0.5, 0.9))
```

Alternative fit using the 'conservative' choice of $n$
```{r }
d.fit <- fitDirichlet(myfit1, myfit2, myfit3,
                  categories = c("Good outcome","Sequel","Dead"),
                  n.fitted = "min")
d.fit
```
